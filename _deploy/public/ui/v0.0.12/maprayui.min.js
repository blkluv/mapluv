!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@mapray/mapray-js")):"function"==typeof define&&define.amd?define(["@mapray/mapray-js"],t):(e=e||self).maprayui=t(e.mapray)}(this,(function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var a=function(e){return e&&e.Math==Math&&e},i=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof t&&t)||Function("return this")(),o=function(e){try{return!!e()}catch(e){return!0}},n=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),_={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c={f:s&&!_.call({1:2},1)?function(e){var t=s(this,e);return!!t&&t.enumerable}:_},u=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},h={}.toString,l="".split,f=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==function(e){return h.call(e).slice(8,-1)}(e)?l.call(e,""):Object(e)}:Object,m=function(e){return f(function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}(e))},p=function(e){return"object"==typeof e?null!==e:"function"==typeof e},d=function(e,t){if(!p(e))return e;var r,a;if(t&&"function"==typeof(r=e.toString)&&!p(a=r.call(e)))return a;if("function"==typeof(r=e.valueOf)&&!p(a=r.call(e)))return a;if(!t&&"function"==typeof(r=e.toString)&&!p(a=r.call(e)))return a;throw TypeError("Can't convert object to primitive value")},v={}.hasOwnProperty,g=function(e,t){return v.call(e,t)},y=i.document,w=p(y)&&p(y.createElement),E=!n&&!o((function(){return 7!=Object.defineProperty((e="div",w?y.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),M=Object.getOwnPropertyDescriptor,A={f:n?M:function(e,t){if(e=m(e),t=d(t,!0),E)try{return M(e,t)}catch(e){}if(g(e,t))return u(!c.f.call(e,t),e[t])}},O=function(e){if(!p(e))throw TypeError(String(e)+" is not an object");return e},T=Object.defineProperty,k={f:n?T:function(e,t,r){if(O(e),t=d(t,!0),O(r),E)try{return T(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},b=n?function(e,t,r){return k.f(e,t,u(1,r))}:function(e,t,r){return e[t]=r,e},R=function(e,t){try{b(i,e,t)}catch(r){i[e]=t}return t},L=i["__core-js_shared__"]||R("__core-js_shared__",{}),N=Function.toString;"function"!=typeof L.inspectSource&&(L.inspectSource=function(e){return N.call(e)});var V,P,I,F,S=L.inspectSource,C=i.WeakMap,G="function"==typeof C&&/native code/.test(S(C)),x=r((function(e){(e.exports=function(e,t){return L[e]||(L[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),D=0,j=Math.random(),U=x("keys"),H={},z=i.WeakMap;if(G){var Y=new z,K=Y.get,q=Y.has,W=Y.set;V=function(e,t){return W.call(Y,e,t),t},P=function(e){return K.call(Y,e)||{}},I=function(e){return q.call(Y,e)}}else{var X=U[F="state"]||(U[F]=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++D+j).toString(36)}(F));H[X]=!0,V=function(e,t){return b(e,X,t),t},P=function(e){return g(e,X)?e[X]:{}},I=function(e){return g(e,X)}}var B={set:V,get:P,has:I,enforce:function(e){return I(e)?P(e):V(e,{})},getterFor:function(e){return function(t){var r;if(!p(t)||(r=P(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},Z=r((function(e){var t=B.get,r=B.enforce,a=String(String).split("String");(e.exports=function(e,t,o,n){var _=!!n&&!!n.unsafe,s=!!n&&!!n.enumerable,c=!!n&&!!n.noTargetGet;"function"==typeof o&&("string"!=typeof t||g(o,"name")||b(o,"name",t),r(o).source=a.join("string"==typeof t?t:"")),e!==i?(_?!c&&e[t]&&(s=!0):delete e[t],s?e[t]=o:b(e,t,o)):s?e[t]=o:R(t,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||S(this)}))})),J=i,Q=function(e){return"function"==typeof e?e:void 0},$=Math.ceil,ee=Math.floor,te=function(e){return isNaN(e=+e)?0:(e>0?ee:$)(e)},re=Math.min,ae=Math.max,ie=Math.min,oe=function(e){return function(t,r,a){var i,o,n=m(t),_=(i=n.length)>0?re(te(i),9007199254740991):0,s=function(e,t){var r=te(e);return r<0?ae(r+t,0):ie(r,t)}(a,_);if(e&&r!=r){for(;_>s;)if((o=n[s++])!=o)return!0}else for(;_>s;s++)if((e||s in n)&&n[s]===r)return e||s||0;return!e&&-1}},ne={includes:oe(!0),indexOf:oe(!1)}.indexOf,_e=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),se={f:Object.getOwnPropertyNames||function(e){return function(e,t){var r,a=m(e),i=0,o=[];for(r in a)!g(H,r)&&g(a,r)&&o.push(r);for(;t.length>i;)g(a,r=t[i++])&&(~ne(o,r)||o.push(r));return o}(e,_e)}},ce={f:Object.getOwnPropertySymbols},ue=function(e,t){return arguments.length<2?Q(J[e])||Q(i[e]):J[e]&&J[e][t]||i[e]&&i[e][t]}("Reflect","ownKeys")||function(e){var t=se.f(O(e)),r=ce.f;return r?t.concat(r(e)):t},he=function(e,t){for(var r=ue(t),a=k.f,i=A.f,o=0;o<r.length;o++){var n=r[o];g(e,n)||a(e,n,i(t,n))}},le=/#|\.prototype\./,fe=function(e,t){var r=pe[me(e)];return r==ve||r!=de&&("function"==typeof t?o(t):!!t)},me=fe.normalize=function(e){return String(e).replace(le,".").toLowerCase()},pe=fe.data={},de=fe.NATIVE="N",ve=fe.POLYFILL="P",ge=fe,ye=A.f;function we(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ae(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}!function(e,t){var r,a,o,n,_,s=e.target,c=e.global,u=e.stat;if(r=c?i:u?i[s]||R(s,{}):(i[s]||{}).prototype)for(a in t){if(n=t[a],o=e.noTargetGet?(_=ye(r,a))&&_.value:r[a],!ge(c?a:s+(u?".":"#")+a,e.forced)&&void 0!==o){if(typeof n==typeof o)continue;he(n,o)}(e.sham||o&&o.sham)&&b(n,"sham",!0),Z(r,a,n,e)}}({target:"Math",stat:!0},{sign:Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}});var Oe=e.GeoMath,Te=e.GeoPoint,ke=function(t){function r(e,t,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=Ae(this,Ee(r).call(this))).createViewer(e,t,a),i._camera_parameter={latitude:0,longitude:0,height:0,pitch:0,yaw:0,fov:0,near:0,far:0},i._initCameraParameter(a),i._operation_mode=r.OperationMode.NONE,i._mouse_down_position=Oe.createVector2f(),i._pre_mouse_position=Oe.createVector2f(),i._rotate_center=Oe.createVector3(),i._translate_drag=Oe.createVector2f(),i._rotate_drag=Oe.createVector2f(),i._free_rotate_drag=Oe.createVector2f(),i._height_drag=Oe.createVector2f(),i._zoom_wheel=0,i._fovy_key=0,i._default_fov=r.DEFAULT_CAMERA_PARAMETER.fov,i._key_mode=!1,i}var a,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(r,t),a=r,(i=[{key:"createViewer",value:function(t,r,a){return this._viewer&&this.destroy(),this._viewer=new e.Viewer(t,{dem_provider:this._createDemProvider(r,a),image_provider:this._createImageProvider(a),layers:a&&a.layers||null,render_callback:this,render_mode:a&&a.render_mode||e.Viewer.RenderMode.SURFACE,debug_stats:a&&a.debug_stats||null,attribution_controller:a&&a.attribution_controller||null}),this._viewer._canvas_element.setAttribute("oncontextmenu","return false;"),this._addEventListener(),this._viewer}},{key:"destroy",value:function(){this._viewer&&(this._removeEventListener(),this._viewer.destroy(),this._viewer=null)}},{key:"_createDemProvider",value:function(t,r){return r&&r.dem_provider||new e.CloudDemProvider(t)}},{key:"_createImageProvider",value:function(t){return t&&t.image_provider||new e.StandardImageProvider("https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/",".jpg",256,2,18)}},{key:"_initCameraParameter",value:function(e){var t=e&&e.camera_position||r.DEFAULT_CAMERA_POSITION,a=e&&e.lookat_position||r.DEFAULT_LOOKAT_POSITION,i=e&&e.camera_parameter||r.DEFAULT_CAMERA_PARAMETER;this.setCameraPosition(t),this.setLookAtPosition(a),this.setCameraParameter(i),this._updateViewerCamera()}},{key:"_addEventListener",value:function(){var e=this._viewer._canvas_element,t=this;window.addEventListener("blur",(function(e){t._onBlur(e)}),{passive:!1}),e.addEventListener("mousedown",(function(e){t._onMouseDown(e)}),{passive:!1}),document.addEventListener("mousemove",(function(e){t._onMouseMove(e)}),{passive:!1}),document.addEventListener("mouseup",(function(e){t._onMouseUp(e)}),{passive:!1}),document.addEventListener("wheel",(function(e){t._onMouseWheel(e)}),{passive:!1}),document.addEventListener("keydown",(function(e){t._onKeyDown(e)}),{passive:!1}),document.addEventListener("keyup",(function(e){t._onKeyUp(e)}),{passive:!1})}},{key:"_removeEventListener",value:function(){var e=this._viewer._canvas_element,t=this;window.removeEventListener("blur",(function(e){t._onBlur(e)}),{passive:!1}),e.removeEventListener("mousedown",(function(e){t._onMouseDown(e)}),{passive:!1}),document.removeEventListener("mousemove",(function(e){t._onMouseMove(e)}),{passive:!1}),document.removeEventListener("mouseup",(function(e){t._onMouseUp(e)}),{passive:!1}),document.removeEventListener("wheel",(function(e){t._onMouseWheel(e)}),{passive:!1}),document.removeEventListener("keydown",(function(e){t._onKeyDown(e)}),{passive:!1}),document.removeEventListener("keyup",(function(e){t._onKeyUp(e)}),{passive:!1})}},{key:"onStart",value:function(){}},{key:"onStop",value:function(){}},{key:"onUpdateFrame",value:function(e){this._translation(e),this._rotation(),this._freeRotation(e),this._translationOfHeight(),this._translationOfEyeDirection(),this._changeFovy(),this._correctAltitude(),this._updateClipPlane(),this._updateViewerCamera()}},{key:"_updateViewerCamera",value:function(){var e=this._viewer.camera,t=new Te(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(Oe.createMatrix()),r=Oe.rotation_matrix([1,0,0],this._camera_parameter.pitch,Oe.createMatrix()),a=Oe.rotation_matrix([0,0,1],this._camera_parameter.yaw,Oe.createMatrix()),i=Oe.mul_AA(a,r,Oe.createMatrix());e.view_to_gocs=Oe.mul_AA(t,i,Oe.createMatrix()),e.fov=this._camera_parameter.fov,e.near=this._camera_parameter.near,e.far=this._camera_parameter.far}},{key:"_updateClipPlane",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude),t=Math.max(this._camera_parameter.height-e,r.MINIMUM_HEIGHT);this._camera_parameter.near=Math.max(t*r.NEAR_FACTOR,r.MINIMUM_NEAR),this._camera_parameter.far=Math.max(this._camera_parameter.near*r.FAR_FACTOR,r.MINIMUM_FAR)}},{key:"_correctAltitude",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude);this._camera_parameter.height=Math.max(this._camera_parameter.height,e+r.MINIMUM_HEIGHT)}},{key:"_onBlur",value:function(e){e.preventDefault(),this._resetEventParameter()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=[e.clientX,e.clientY];if(this._mouse_down_position=t,this._pre_mouse_position=t,0==e.button)if(e.shiftKey){this._operation_mode=r.OperationMode.ROTATE;var a=this._viewer.camera.getCanvasRay(this._mouse_down_position);this._rotate_center=this._viewer.getRayIntersection(a)}else e.ctrlKey?this._operation_mode=r.OperationMode.FREE_ROTATE:this._operation_mode=r.OperationMode.TRANSLATE;else 1==e.button?(this._operation_mode=r.OperationMode.ROTATE,a=this._viewer.camera.getCanvasRay(this._mouse_down_position),this._rotate_center=this._viewer.getRayIntersection(a)):2==e.button&&(this._operation_mode=r.OperationMode.HEIGHT_TRANSLATE)}},{key:"_onMouseMove",value:function(e){e.preventDefault();var t=[e.clientX,e.clientY];this._operation_mode==r.OperationMode.TRANSLATE?(this._translate_drag[0]+=t[0]-this._pre_mouse_position[0],this._translate_drag[1]+=t[1]-this._pre_mouse_position[1]):this._operation_mode==r.OperationMode.ROTATE?(this._rotate_drag[0]+=t[0]-this._pre_mouse_position[0],this._rotate_drag[1]+=t[1]-this._pre_mouse_position[1]):this._operation_mode==r.OperationMode.FREE_ROTATE?(this._free_rotate_drag[0]+=t[0]-this._pre_mouse_position[0],this._free_rotate_drag[1]+=t[1]-this._pre_mouse_position[1]):this._operation_mode==r.OperationMode.HEIGHT_TRANSLATE&&(this._translate_drag[0]+=t[0]-this._pre_mouse_position[0],this._height_drag[1]+=t[1]-this._pre_mouse_position[1]),this._pre_mouse_position=t}},{key:"_onMouseUp",value:function(e){e.preventDefault(),this._resetEventParameter()}},{key:"_onMouseWheel",value:function(e){e.preventDefault();var t,r=[e.clientX,e.clientY];this._mouse_down_position=r,t=-1*Math.sign(e.deltaY)*Math.ceil(Math.abs(e.deltaY)/100),this._zoom_wheel+=t}},{key:"_onKeyDown",value:function(e){switch(e.preventDefault(),e.key){case"c":case"C":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=1;break;case"z":case"Z":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=-1;break;case"x":case"X":this._camera_parameter.fov=this._default_fov;break;case"ArrowUp":var t=[(a=this._viewer.canvas_element).width/2,a.height/2];this._mouse_down_position=t,this._translate_drag[1]=100,this._key_mode=!0;break;case"ArrowDown":var a;t=[(a=this._viewer.canvas_element).width/2,a.height/2],this._mouse_down_position=t,this._translate_drag[1]=-100,this._key_mode=!0;break;case"ArrowLeft":this._free_rotate_drag[0]=100,this._key_mode=!0;break;case"ArrowRight":this._free_rotate_drag[0]=-100,this._key_mode=!0}}},{key:"_onKeyUp",value:function(e){switch(e.preventDefault(),e.key){case"c":case"C":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"z":case"Z":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"ArrowUp":case"ArrowDown":this._operation_mode=r.OperationMode.NONE,this._translate_drag[1]=0,this._key_mode=!1;break;case"ArrowLeft":case"ArrowRight":this._operation_mode=r.OperationMode.NONE,this._free_rotate_drag[0]=0,this._key_mode=!1}}},{key:"_resetEventParameter",value:function(){this._translate_drag[0]=0,this._translate_drag[1]=0,this._rotate_drag[0]=0,this._rotate_drag[1]=0,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0,this._height_drag[0]=0,this._height_drag[1]=0,this._operation_mode=r.OperationMode.NONE}},{key:"_translation",value:function(t){if(0!=this._translate_drag[0]||0!=this._translate_drag[1]){this._key_mode&&(this._translate_drag[0]*=t,this._translate_drag[1]*=t);var r=this._viewer.camera,a=r.getCanvasRay(this._mouse_down_position),i=this._viewer.getRayIntersection(a),o=[this._mouse_down_position[0]+this._translate_drag[0],this._mouse_down_position[1]+this._translate_drag[1]];a=r.getCanvasRay(o);var n=this._viewer.getRayIntersection(a);if(null==i||null==n)return;var _=new e.GeoPoint;_.setFromGocs(i);var s=new e.GeoPoint;s.setFromGocs(n);var c=Math.pow(this._getVectorLength(a.direction),2),u=2*Oe.dot3(a.position,a.direction),h=u*u-4*c*(Math.pow(this._getVectorLength(a.position),2)-Math.pow(_.altitude+Oe.EARTH_RADIUS,2));if(_.altitude<this._camera_parameter.height&&s.altitude<this._camera_parameter.height&&h>0){var l=(-u+Math.sqrt(h))/2*c,f=(-u-Math.sqrt(h))/2*c,m=Math.min(l,f);n[0]=a.position[0]+m*a.direction[0],n[1]=a.position[1]+m*a.direction[1],n[2]=a.position[2]+m*a.direction[2],s.setFromGocs(n)}var p=s.latitude-_.latitude,d=s.longitude-_.longitude;this._camera_parameter.latitude-=p,this._camera_parameter.longitude-=d,this._translate_drag[0]=0,this._translate_drag[1]=0,this._mouse_down_position=this._pre_mouse_position}}},{key:"_rotation",value:function(){if(0!=this._rotate_drag[0]||0!=this._rotate_drag[1]){if(null==this._rotate_center)return this._rotate_drag[0]=0,void(this._rotate_drag[1]=0);var t=this._viewer.camera,r=Oe.createVector3();r[0]=t.view_to_gocs[12]-this._rotate_center[0],r[1]=t.view_to_gocs[13]-this._rotate_center[1],r[2]=t.view_to_gocs[14]-this._rotate_center[2];var a=new e.GeoPoint;a.setFromGocs(this._rotate_center);var i=a.getMlocsToGocsMatrix(Oe.createMatrix()),o=Oe.createVector3();o[0]=i[8],o[1]=i[9],o[2]=i[10],o=Oe.normalize3(o,Oe.createVector3());var n=-this._rotate_drag[0]/10,_=-this._rotate_drag[1]/10,s=this._rotateVector(r,o,n),c=Oe.clamp(this._camera_parameter.pitch+_,0,90);c!=this._camera_parameter.pitch&&(o[0]=t.view_to_gocs[0],o[1]=t.view_to_gocs[1],o[2]=t.view_to_gocs[2],s=this._rotateVector(s,o,_));var u=Oe.createVector3();u[0]=this._rotate_center[0]+s[0],u[1]=this._rotate_center[1]+s[1],u[2]=this._rotate_center[2]+s[2];var h=new e.GeoPoint;h.setFromGocs(u),this._camera_parameter.latitude=h.latitude,this._camera_parameter.longitude=h.longitude,this._camera_parameter.height=h.altitude,this._camera_parameter.yaw+=n,this._camera_parameter.pitch=c,this._rotate_drag[0]=0,this._rotate_drag[1]=0}}},{key:"_freeRotation",value:function(e){if(0!=this._free_rotate_drag[0]||0!=this._free_rotate_drag[1]){this._key_mode&&(this._free_rotate_drag[0]*=e,this._free_rotate_drag[1]*=e);var t=this._free_rotate_drag[0]/10,r=this._free_rotate_drag[1]/10,a=Oe.clamp(this._camera_parameter.pitch+r,0,90);this._camera_parameter.yaw+=t,this._camera_parameter.pitch=a,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0}}},{key:"_translationOfHeight",value:function(){if(0!=this._height_drag[0]||0!=this._height_drag[1]){var e=100*this._height_drag[1]*(Oe.gudermannian((this._camera_parameter.height-5e4)/1e4)+Math.PI/2);this._camera_parameter.height+=e,this._height_drag[0]=0,this._height_drag[1]=0}}},{key:"_translationOfEyeDirection",value:function(){if(0!=this._zoom_wheel){var t=this._viewer.camera,r=t.getCanvasRay(this._mouse_down_position),a=this._viewer.getRayIntersection(r);if(null==a)return void(this._zoom_wheel=0);var i=new e.GeoPoint;i.setFromGocs(a);var o=1;if(this._camera_parameter.height>3e4)o=Math.abs(this._camera_parameter.height-i.altitude)/3e4;else{var n=3/Math.pow(i.altitude/1e3-30,2),_=this._camera_parameter.height/1e3-30,s=n*Math.pow(_,2)*_/Math.abs(_);o=Oe.gudermannian(s)+Math.PI/2}var c=this._zoom_wheel*this._camera_parameter.speed_factor*o,u=Oe.createVector3();u[0]=a[0]-t.view_to_gocs[12],u[1]=a[1]-t.view_to_gocs[13],u[2]=a[2]-t.view_to_gocs[14];var h=Oe.createVector3();Oe.normalize3(u,h);var l=Oe.createVector3();l[0]=t.view_to_gocs[12]+c*h[0],l[1]=t.view_to_gocs[13]+c*h[1],l[2]=t.view_to_gocs[14]+c*h[2];var f=Oe.createVector3();if(f[0]=l[0]-t.view_to_gocs[12],f[1]=l[1]-t.view_to_gocs[13],f[2]=l[2]-t.view_to_gocs[14],this._zoom_wheel<0||this._getVectorLength(u)>this._getVectorLength(f)){var m=new e.GeoPoint;m.setFromGocs(l),this._camera_parameter.latitude=m.latitude,this._camera_parameter.longitude=m.longitude,this._camera_parameter.height=m.altitude}this._zoom_wheel=0}}},{key:"_changeFovy",value:function(){var e=Math.tan(.5*this._camera_parameter.fov*Oe.DEGREE),t=2*Math.atan(e*Math.pow(r.FOV_FACTOR,-this._fovy_key)),a=r.FOV_RANGE;this._camera_parameter.fov=Oe.clamp(t/Oe.DEGREE,a.min,a.max),this._fovy_key=0}},{key:"setCameraPosition",value:function(e){this._camera_parameter.latitude=e.latitude,this._camera_parameter.longitude=e.longitude,this._camera_parameter.height=e.height,this._camera_parameter.height<r.MINIMUM_HEIGHT&&(this._camera_parameter.height=r.MINIMUM_HEIGHT)}},{key:"setLookAtPosition",value:function(e){var t=new Te(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(Oe.createMatrix()),r=Oe.createVector3();r[0]=t[4],r[1]=t[5],r[2]=t[6];var a=new Te(e.longitude,e.latitude,e.height).getMlocsToGocsMatrix(Oe.createMatrix()),i=Oe.createVector3();i[0]=a[12]-t[12],i[1]=a[13]-t[13],i[2]=a[14]-t[14],r=Oe.normalize3(r,Oe.createVector3()),i=Oe.normalize3(i,Oe.createVector3());var o=Oe.createVector3();o[0]=t[8],o[1]=t[9],o[2]=t[10];var n=this._calculateAngle(o,r,i);this._camera_parameter.yaw=n;var _=Oe.createVector3();_[0]=t[8],_[1]=t[9],_[2]=t[10],o[0]=t[0],o[1]=t[1],o[2]=t[2],i[0]=-1*i[0],i[1]=-1*i[1],i[2]=-1*i[2],this._camera_parameter.pitch=Oe.clamp(Math.abs(this._calculateAngle(o,_,i)),0,90)}},{key:"setCameraParameter",value:function(e){e.fov&&(this._camera_parameter.fov=e.fov,this._default_fov=e.fov),e.near&&(this._camera_parameter.near=e.near),e.far&&(this._camera_parameter.far=e.far),e.speed_factor&&(this._camera_parameter.speed_factor=e.speed_factor)}},{key:"getLayer",value:function(e){return this._viewer.layers.getLayer(e)}},{key:"getLayerNum",value:function(){return this._viewer.layers.num_layers()}},{key:"addLayer",value:function(e){this._viewer.layers.add(e)}},{key:"insertLayer",value:function(e,t){this._viewer.layers.insert(e,t)}},{key:"removeLayer",value:function(e){this._viewer.layers.remove(e)}},{key:"clearLayer",value:function(){this._viewer.layers.clear()}},{key:"getEntity",value:function(e){return this._viewer.scene.getEntity(e)}},{key:"getEntityNum",value:function(){return this._viewer.scene.num_entities()}},{key:"addEntity",value:function(e){this._viewer.scene.addEntity(e)}},{key:"removeEntity",value:function(e){this._viewer.scene.removeEntity(e)}},{key:"clearEntity",value:function(){this._viewer.scene.clearEntity()}},{key:"_getVectorLength",value:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))}},{key:"_rotateVector",value:function(e,t,r){var a=Oe.rotation_matrix(t,r,Oe.createMatrix()),i=Oe.createVector3();return i[0]=e[0]*a[0]+e[1]*a[4]+e[2]*a[8]+a[12],i[1]=e[0]*a[1]+e[1]*a[5]+e[2]*a[9]+a[13],i[2]=e[0]*a[2]+e[1]*a[6]+e[2]*a[10]+a[14],i}},{key:"_calculateAngle",value:function(e,t,r){for(var a=Oe.createVector3(),i=Oe.dot3(e,t),o=0;o<3;o++)a[o]=t[o]-i*e[o];var n=Oe.createVector3();for(i=Oe.dot3(e,r),o=0;o<3;o++)n[o]=r[o]-i*e[o];if(Oe.normalize3(a,a),Oe.normalize3(n,n),Math.abs(this._getVectorLength(a)<1e-6)||Math.abs(this._getVectorLength(n)<1e-6))_=0;else{var _=Math.acos(Oe.clamp(Oe.dot3(a,n)/(this._getVectorLength(a)*this._getVectorLength(n)),-1,1))/Oe.DEGREE,s=Oe.cross3(a,n,Oe.createVector3());s=Oe.normalize3(s,Oe.createVector3()),Oe.dot3(e,s)<0&&(_*=-1)}return _}},{key:"viewer",get:function(){return this._viewer}}])&&we(a.prototype,i),o&&we(a,o),r}(e.RenderCallback);return ke.OperationMode={NONE:"NONE",TRANSLATE:"TRANSLATE",ROTATE:"ROTATE",FREE_ROTATE:"FREE_ROTATE",EYE_TRANSLATE:"EYE_TRANSLATE",HEIGHT_TRANSLATE:"HEIGHT_TRANSLATE",CHANGE_FOVY:"CHANGE_FOVY"},ke.DEFAULT_CAMERA_POSITION={latitude:35.475968,longitude:138.573161,height:2e3},ke.DEFAULT_LOOKAT_POSITION={latitude:35.360626,longitude:138.727363,height:2e3},ke.DEFAULT_CAMERA_PARAMETER={fov:60,near:30,far:5e5,speed_factor:5e3},ke.MINIMUM_HEIGHT=15,ke.MINIMUM_NEAR=1,ke.MINIMUM_FAR=5e5,ke.NEAR_FACTOR=.5,ke.FAR_FACTOR=1e4,ke.FOV_RANGE={min:5,max:120},ke.FOV_FACTOR=1.148698354997035,{StandardUIViewer:ke}}));
