!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@mapray/mapray-js")):"function"==typeof define&&define.amd?define(["@mapray/mapray-js"],t):(e=e||self).maprayui=t(e.mapray)}(this,(function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e},i=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),a=function(e){try{return!!e()}catch(e){return!0}},o=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,u={f:c&&!s.call({1:2},1)?function(e){var t=c(this,e);return!!t&&t.enumerable}:s},l=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_={}.toString,h=function(e){return _.call(e).slice(8,-1)},f="".split,d=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==h(e)?f.call(e,""):Object(e)}:Object,p=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return d(p(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},g=function(e,t){if(!m(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!m(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!m(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!m(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},y={}.hasOwnProperty,w=function(e,t){return y.call(e,t)},E=i.document,M=m(E)&&m(E.createElement),b=function(e){return M?E.createElement(e):{}},A=!o&&!a((function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a})),x=Object.getOwnPropertyDescriptor,R={f:o?x:function(e,t){if(e=v(e),t=g(t,!0),A)try{return x(e,t)}catch(e){}if(w(e,t))return l(!u.f.call(e,t),e[t])}},T=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},O=Object.defineProperty,k={f:o?O:function(e,t,r){if(T(e),t=g(t,!0),T(r),A)try{return O(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},L=o?function(e,t,r){return k.f(e,t,l(1,r))}:function(e,t,r){return e[t]=r,e},P=function(e,t){try{L(i,e,t)}catch(r){i[e]=t}return t},S=i["__core-js_shared__"]||P("__core-js_shared__",{}),C=Function.toString;"function"!=typeof S.inspectSource&&(S.inspectSource=function(e){return C.call(e)});var F,N,I,j=S.inspectSource,G=i.WeakMap,V="function"==typeof G&&/native code/.test(j(G)),U=r((function(e){(e.exports=function(e,t){return S[e]||(S[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),D=0,H=Math.random(),K=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++D+H).toString(36)},z=U("keys"),B=function(e){return z[e]||(z[e]=K(e))},Y={},$=i.WeakMap;if(V){var W=new $,q=W.get,X=W.has,Z=W.set;F=function(e,t){return Z.call(W,e,t),t},N=function(e){return q.call(W,e)||{}},I=function(e){return X.call(W,e)}}else{var J=B("state");Y[J]=!0,F=function(e,t){return L(e,J,t),t},N=function(e){return w(e,J)?e[J]:{}},I=function(e){return w(e,J)}}var Q,ee,te={set:F,get:N,has:I,enforce:function(e){return I(e)?N(e):F(e,{})},getterFor:function(e){return function(t){var r;if(!m(t)||(r=N(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},re=r((function(e){var t=te.get,r=te.enforce,n=String(String).split("String");(e.exports=function(e,t,a,o){var s=!!o&&!!o.unsafe,c=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof a&&("string"!=typeof t||w(a,"name")||L(a,"name",t),r(a).source=n.join("string"==typeof t?t:"")),e!==i?(s?!u&&e[t]&&(c=!0):delete e[t],c?e[t]=a:L(e,t,a)):c?e[t]=a:P(t,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||j(this)}))})),ne=i,ie=function(e){return"function"==typeof e?e:void 0},ae=function(e,t){return arguments.length<2?ie(ne[e])||ie(i[e]):ne[e]&&ne[e][t]||i[e]&&i[e][t]},oe=Math.ceil,se=Math.floor,ce=function(e){return isNaN(e=+e)?0:(e>0?se:oe)(e)},ue=Math.min,le=function(e){return e>0?ue(ce(e),9007199254740991):0},_e=Math.max,he=Math.min,fe=function(e,t){var r=ce(e);return r<0?_e(r+t,0):he(r,t)},de=function(e){return function(t,r,n){var i,a=v(t),o=le(a.length),s=fe(n,o);if(e&&r!=r){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},pe={includes:de(!0),indexOf:de(!1)}.indexOf,ve=function(e,t){var r,n=v(e),i=0,a=[];for(r in n)!w(Y,r)&&w(n,r)&&a.push(r);for(;t.length>i;)w(n,r=t[i++])&&(~pe(a,r)||a.push(r));return a},me=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ge=me.concat("length","prototype"),ye={f:Object.getOwnPropertyNames||function(e){return ve(e,ge)}},we={f:Object.getOwnPropertySymbols},Ee=ae("Reflect","ownKeys")||function(e){var t=ye.f(T(e)),r=we.f;return r?t.concat(r(e)):t},Me=function(e,t){for(var r=Ee(t),n=k.f,i=R.f,a=0;a<r.length;a++){var o=r[a];w(e,o)||n(e,o,i(t,o))}},be=/#|\.prototype\./,Ae=function(e,t){var r=Re[xe(e)];return r==Oe||r!=Te&&("function"==typeof t?a(t):!!t)},xe=Ae.normalize=function(e){return String(e).replace(be,".").toLowerCase()},Re=Ae.data={},Te=Ae.NATIVE="N",Oe=Ae.POLYFILL="P",ke=Ae,Le=R.f,Pe=function(e,t){var r,n,a,o,s,c=e.target,u=e.global,l=e.stat;if(r=u?i:l?i[c]||P(c,{}):(i[c]||{}).prototype)for(n in t){if(o=t[n],a=e.noTargetGet?(s=Le(r,n))&&s.value:r[n],!ke(u?n:c+(l?".":"#")+n,e.forced)&&void 0!==a){if(typeof o==typeof a)continue;Me(o,a)}(e.sham||a&&a.sham)&&L(o,"sham",!0),re(r,n,o,e)}},Se=Array.isArray||function(e){return"Array"==h(e)},Ce=function(e){return Object(p(e))},Fe=function(e,t,r){var n=g(t);n in e?k.f(e,n,l(0,r)):e[n]=r},Ne=!!Object.getOwnPropertySymbols&&!a((function(){return!String(Symbol())})),Ie=Ne&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,je=U("wks"),Ge=i.Symbol,Ve=Ie?Ge:Ge&&Ge.withoutSetter||K,Ue=function(e){return w(je,e)||(Ne&&w(Ge,e)?je[e]=Ge[e]:je[e]=Ve("Symbol."+e)),je[e]},De=Ue("species"),He=function(e,t){var r;return Se(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!Se(r.prototype)?m(r)&&null===(r=r[De])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)},Ke=ae("navigator","userAgent")||"",ze=i.process,Be=ze&&ze.versions,Ye=Be&&Be.v8;Ye?ee=(Q=Ye.split("."))[0]+Q[1]:Ke&&(!(Q=Ke.match(/Edge\/(\d+)/))||Q[1]>=74)&&(Q=Ke.match(/Chrome\/(\d+)/))&&(ee=Q[1]);var $e=ee&&+ee,We=Ue("species"),qe=function(e){return $e>=51||!a((function(){var t=[];return(t.constructor={})[We]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Xe=Ue("isConcatSpreadable"),Ze=$e>=51||!a((function(){var e=[];return e[Xe]=!1,e.concat()[0]!==e})),Je=qe("concat"),Qe=function(e){if(!m(e))return!1;var t=e[Xe];return void 0!==t?!!t:Se(e)};Pe({target:"Array",proto:!0,forced:!Ze||!Je},{concat:function(e){var t,r,n,i,a,o=Ce(this),s=He(o,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(a=-1===t?o:arguments[t],Qe(a)){if(c+(i=le(a.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<i;r++,c++)r in a&&Fe(s,c,a[r])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Fe(s,c++,a)}return s.length=c,s}});var et,tt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},rt=function(e,t,r){if(tt(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},nt=[].push,it=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,o=5==e||a;return function(s,c,u,l){for(var _,h,f=Ce(s),p=d(f),v=rt(c,u,3),m=le(p.length),g=0,y=l||He,w=t?y(s,m):r?y(s,0):void 0;m>g;g++)if((o||g in p)&&(h=v(_=p[g],g,f),e))if(t)w[g]=h;else if(h)switch(e){case 3:return!0;case 5:return _;case 6:return g;case 2:nt.call(w,_)}else if(i)return!1;return a?-1:n||i?i:w}},at={forEach:it(0),map:it(1),filter:it(2),some:it(3),every:it(4),find:it(5),findIndex:it(6)},ot=Object.keys||function(e){return ve(e,me)},st=o?Object.defineProperties:function(e,t){T(e);for(var r,n=ot(t),i=n.length,a=0;i>a;)k.f(e,r=n[a++],t[r]);return e},ct=ae("document","documentElement"),ut=B("IE_PROTO"),lt=function(){},_t=function(e){return"<script>"+e+"<\/script>"},ht=function(){try{et=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;ht=et?function(e){e.write(_t("")),e.close();var t=e.parentWindow.Object;return e=null,t}(et):((t=b("iframe")).style.display="none",ct.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(_t("document.F=Object")),e.close(),e.F);for(var r=me.length;r--;)delete ht.prototype[me[r]];return ht()};Y[ut]=!0;var ft=Object.create||function(e,t){var r;return null!==e?(lt.prototype=T(e),r=new lt,lt.prototype=null,r[ut]=e):r=ht(),void 0===t?r:st(r,t)},dt=Ue("unscopables"),pt=Array.prototype;null==pt[dt]&&k.f(pt,dt,{configurable:!0,value:ft(null)});var vt,mt=Object.defineProperty,gt={},yt=function(e){throw e},wt=function(e,t){if(w(gt,e))return gt[e];t||(t={});var r=[][e],n=!!w(t,"ACCESSORS")&&t.ACCESSORS,i=w(t,0)?t[0]:yt,s=w(t,1)?t[1]:void 0;return gt[e]=!!r&&!a((function(){if(n&&!o)return!0;var e={length:-1};n?mt(e,1,{enumerable:!0,get:yt}):e[1]=1,r.call(e,i,s)}))},Et=at.find,Mt=!0,bt=wt("find");"find"in[]&&Array(1).find((function(){Mt=!1})),Pe({target:"Array",proto:!0,forced:Mt||!bt},{find:function(e){return Et(this,e,arguments.length>1?arguments[1]:void 0)}}),vt="find",pt[dt][vt]=!0;var At=qe("slice"),xt=wt("slice",{ACCESSORS:!0,0:0,1:2}),Rt=Ue("species"),Tt=[].slice,Ot=Math.max;Pe({target:"Array",proto:!0,forced:!At||!xt},{slice:function(e,t){var r,n,i,a=v(this),o=le(a.length),s=fe(e,o),c=fe(void 0===t?o:t,o);if(Se(a)&&("function"!=typeof(r=a.constructor)||r!==Array&&!Se(r.prototype)?m(r)&&null===(r=r[Rt])&&(r=void 0):r=void 0,r===Array||void 0===r))return Tt.call(a,s,c);for(n=new(void 0===r?Array:r)(Ot(c-s,0)),i=0;s<c;s++,i++)s in a&&Fe(n,i,a[s]);return n.length=i,n}});var kt=[].slice,Lt={},Pt=function(e,t,r){if(!(t in Lt)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";Lt[t]=Function("C,a","return new C("+n.join(",")+")")}return Lt[t](e,r)};Pe({target:"Function",proto:!0},{bind:Function.bind||function(e){var t=tt(this),r=kt.call(arguments,1),n=function(){var i=r.concat(kt.call(arguments));return this instanceof n?Pt(t,i.length,i):t.apply(e,i)};return m(t.prototype)&&(n.prototype=t.prototype),n}}),Pe({target:"Math",stat:!0},{sign:Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}});var St="".repeat||function(e){var t=String(p(this)),r="",n=ce(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},Ct=1..toFixed,Ft=Math.floor,Nt=function(e,t,r){return 0===t?r:t%2==1?Nt(e,t-1,r*e):Nt(e*e,t/2,r)};Pe({target:"Number",proto:!0,forced:Ct&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!a((function(){Ct.call({})}))},{toFixed:function(e){var t,r,n,i,a=function(e){if("number"!=typeof e&&"Number"!=h(e))throw TypeError("Incorrect invocation");return+e}(this),o=ce(e),s=[0,0,0,0,0,0],c="",u="0",l=function(e,t){for(var r=-1,n=t;++r<6;)n+=e*s[r],s[r]=n%1e7,n=Ft(n/1e7)},_=function(e){for(var t=6,r=0;--t>=0;)r+=s[t],s[t]=Ft(r/e),r=r%e*1e7},f=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var r=String(s[e]);t=""===t?r:t+St.call("0",7-r.length)+r}return t};if(o<0||o>20)throw RangeError("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return String(a);if(a<0&&(c="-",a=-a),a>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(a*Nt(2,69,1))-69)<0?a*Nt(2,-t,1):a/Nt(2,t,1),r*=4503599627370496,(t=52-t)>0){for(l(0,r),n=o;n>=7;)l(1e7,0),n-=7;for(l(Nt(10,n,1),0),n=t-1;n>=23;)_(1<<23),n-=23;_(1<<n),l(1,1),_(2),u=f()}else l(0,r),l(1<<-t,0),u=f()+St.call("0",o);return u=o>0?c+((i=u.length)<=o?"0."+St.call("0",o-i)+u:u.slice(0,i-o)+"."+u.slice(i-o)):c+u}});var It={};It[Ue("toStringTag")]="z";var jt="[object z]"===String(It),Gt=Ue("toStringTag"),Vt="Arguments"==h(function(){return arguments}()),Ut=jt?h:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Gt))?r:Vt?h(t):"Object"==(n=h(t))&&"function"==typeof t.callee?"Arguments":n},Dt=jt?{}.toString:function(){return"[object "+Ut(this)+"]"};jt||re(Object.prototype,"toString",Dt,{unsafe:!0});var Ht="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Kt="["+Ht+"]",zt=RegExp("^"+Kt+Kt+"*"),Bt=RegExp(Kt+Kt+"*$"),Yt=function(e){return function(t){var r=String(p(t));return 1&e&&(r=r.replace(zt,"")),2&e&&(r=r.replace(Bt,"")),r}},$t={start:Yt(1),end:Yt(2),trim:Yt(3)}.trim,Wt=i.parseFloat,qt=1/Wt(Ht+"-0")!=-1/0?function(e){var t=$t(String(e)),r=Wt(t);return 0===r&&"-"==t.charAt(0)?-0:r}:Wt;Pe({global:!0,forced:parseFloat!=qt},{parseFloat:qt});var Xt=i.Promise,Zt=k.f,Jt=Ue("toStringTag"),Qt=Ue("species"),er={},tr=Ue("iterator"),rr=Array.prototype,nr=Ue("iterator"),ir=function(e,t,r,n){try{return n?t(T(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&T(i.call(e)),t}},ar=r((function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,r,n,i,a){var o,s,c,u,l,_,h,f,d=rt(r,n,i?2:1);if(a)o=e;else{if("function"!=typeof(s=function(e){if(null!=e)return e[nr]||e["@@iterator"]||er[Ut(e)]}(e)))throw TypeError("Target is not iterable");if(void 0!==(f=s)&&(er.Array===f||rr[tr]===f)){for(c=0,u=le(e.length);u>c;c++)if((l=i?d(T(h=e[c])[0],h[1]):d(e[c]))&&l instanceof t)return l;return new t(!1)}o=s.call(e)}for(_=o.next;!(h=_.call(o)).done;)if("object"==typeof(l=ir(o,d,h.value,i))&&l&&l instanceof t)return l;return new t(!1)}).stop=function(e){return new t(!0,e)}})),or=Ue("iterator"),sr=!1;try{var cr=0,ur={next:function(){return{done:!!cr++}},return:function(){sr=!0}};ur[or]=function(){return this},Array.from(ur,(function(){throw 2}))}catch(e){}var lr,_r,hr,fr=Ue("species"),dr=function(e,t){var r,n=T(e).constructor;return void 0===n||null==(r=T(n)[fr])?t:tt(r)},pr=/(iphone|ipod|ipad).*applewebkit/i.test(Ke),vr=i.location,mr=i.setImmediate,gr=i.clearImmediate,yr=i.process,wr=i.MessageChannel,Er=i.Dispatch,Mr=0,br={},Ar=function(e){if(br.hasOwnProperty(e)){var t=br[e];delete br[e],t()}},xr=function(e){return function(){Ar(e)}},Rr=function(e){Ar(e.data)},Tr=function(e){i.postMessage(e+"",vr.protocol+"//"+vr.host)};mr&&gr||(mr=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return br[++Mr]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},lr(Mr),Mr},gr=function(e){delete br[e]},"process"==h(yr)?lr=function(e){yr.nextTick(xr(e))}:Er&&Er.now?lr=function(e){Er.now(xr(e))}:wr&&!pr?(hr=(_r=new wr).port2,_r.port1.onmessage=Rr,lr=rt(hr.postMessage,hr,1)):!i.addEventListener||"function"!=typeof postMessage||i.importScripts||a(Tr)?lr="onreadystatechange"in b("script")?function(e){ct.appendChild(b("script")).onreadystatechange=function(){ct.removeChild(this),Ar(e)}}:function(e){setTimeout(xr(e),0)}:(lr=Tr,i.addEventListener("message",Rr,!1)));var Or,kr,Lr,Pr,Sr,Cr,Fr,Nr,Ir={set:mr,clear:gr},jr=R.f,Gr=Ir.set,Vr=i.MutationObserver||i.WebKitMutationObserver,Ur=i.process,Dr=i.Promise,Hr="process"==h(Ur),Kr=jr(i,"queueMicrotask"),zr=Kr&&Kr.value;zr||(Or=function(){var e,t;for(Hr&&(e=Ur.domain)&&e.exit();kr;){t=kr.fn,kr=kr.next;try{t()}catch(e){throw kr?Pr():Lr=void 0,e}}Lr=void 0,e&&e.enter()},Hr?Pr=function(){Ur.nextTick(Or)}:Vr&&!pr?(Sr=!0,Cr=document.createTextNode(""),new Vr(Or).observe(Cr,{characterData:!0}),Pr=function(){Cr.data=Sr=!Sr}):Dr&&Dr.resolve?(Fr=Dr.resolve(void 0),Nr=Fr.then,Pr=function(){Nr.call(Fr,Or)}):Pr=function(){Gr.call(i,Or)});var Br,Yr,$r,Wr,qr,Xr,Zr,Jr=zr||function(e){var t={fn:e,next:void 0};Lr&&(Lr.next=t),kr||(kr=t,Pr()),Lr=t},Qr=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=tt(t),this.reject=tt(r)},en={f:function(e){return new Qr(e)}},tn=function(e,t){if(T(e),m(t)&&t.constructor===e)return t;var r=en.f(e);return(0,r.resolve)(t),r.promise},rn=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},nn=Ir.set,an=Ue("species"),on="Promise",sn=te.get,cn=te.set,un=te.getterFor(on),ln=Xt,_n=i.TypeError,hn=i.document,fn=i.process,dn=ae("fetch"),pn=en.f,vn=pn,mn="process"==h(fn),gn=!!(hn&&hn.createEvent&&i.dispatchEvent),yn=ke(on,(function(){if(!(j(ln)!==String(ln))){if(66===$e)return!0;if(!mn&&"function"!=typeof PromiseRejectionEvent)return!0}if($e>=51&&/native code/.test(ln))return!1;var e=ln.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[an]=t,!(e.then((function(){}))instanceof t)})),wn=yn||!function(e,t){if(!t&&!sr)return!1;var r=!1;try{var n={};n[or]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}((function(e){ln.all(e).catch((function(){}))})),En=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},Mn=function(e,t,r){if(!t.notified){t.notified=!0;var n=t.reactions;Jr((function(){for(var i=t.value,a=1==t.state,o=0;n.length>o;){var s,c,u,l=n[o++],_=a?l.ok:l.fail,h=l.resolve,f=l.reject,d=l.domain;try{_?(a||(2===t.rejection&&Rn(e,t),t.rejection=1),!0===_?s=i:(d&&d.enter(),s=_(i),d&&(d.exit(),u=!0)),s===l.promise?f(_n("Promise-chain cycle")):(c=En(s))?c.call(s,h,f):h(s)):f(i)}catch(e){d&&!u&&d.exit(),f(e)}}t.reactions=[],t.notified=!1,r&&!t.rejection&&An(e,t)}))}},bn=function(e,t,r){var n,a;gn?((n=hn.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),i.dispatchEvent(n)):n={promise:t,reason:r},(a=i["on"+e])?a(n):"unhandledrejection"===e&&function(e,t){var r=i.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},An=function(e,t){nn.call(i,(function(){var r,n=t.value;if(xn(t)&&(r=rn((function(){mn?fn.emit("unhandledRejection",n,e):bn("unhandledrejection",e,n)})),t.rejection=mn||xn(t)?2:1,r.error))throw r.value}))},xn=function(e){return 1!==e.rejection&&!e.parent},Rn=function(e,t){nn.call(i,(function(){mn?fn.emit("rejectionHandled",e):bn("rejectionhandled",e,t.value)}))},Tn=function(e,t,r,n){return function(i){e(t,r,i,n)}},On=function(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,Mn(e,t,!0))},kn=function(e,t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(e===r)throw _n("Promise can't be resolved itself");var i=En(r);i?Jr((function(){var n={done:!1};try{i.call(r,Tn(kn,e,n,t),Tn(On,e,n,t))}catch(r){On(e,n,r,t)}})):(t.value=r,t.state=1,Mn(e,t,!1))}catch(r){On(e,{done:!1},r,t)}}};yn&&(ln=function(e){!function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation")}(this,ln,on),tt(e),Br.call(this);var t=sn(this);try{e(Tn(kn,this,t),Tn(On,this,t))}catch(e){On(this,t,e)}},(Br=function(e){cn(this,{type:on,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(e,t,r){for(var n in t)re(e,n,t[n],r);return e}(ln.prototype,{then:function(e,t){var r=un(this),n=pn(dr(this,ln));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=mn?fn.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&Mn(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Yr=function(){var e=new Br,t=sn(e);this.promise=e,this.resolve=Tn(kn,e,t),this.reject=Tn(On,e,t)},en.f=pn=function(e){return e===ln||e===$r?new Yr(e):vn(e)},"function"==typeof Xt&&(Wr=Xt.prototype.then,re(Xt.prototype,"then",(function(e,t){var r=this;return new ln((function(e,t){Wr.call(r,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof dn&&Pe({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return tn(ln,dn.apply(i,arguments))}}))),Pe({global:!0,wrap:!0,forced:yn},{Promise:ln}),Xr=on,Zr=!1,(qr=ln)&&!w(qr=Zr?qr:qr.prototype,Jt)&&Zt(qr,Jt,{configurable:!0,value:Xr}),function(e){var t=ae(e),r=k.f;o&&t&&!t[Qt]&&r(t,Qt,{configurable:!0,get:function(){return this}})}(on),$r=ae(on),Pe({target:on,stat:!0,forced:yn},{reject:function(e){var t=pn(this);return t.reject.call(void 0,e),t.promise}}),Pe({target:on,stat:!0,forced:yn},{resolve:function(e){return tn(this,e)}}),Pe({target:on,stat:!0,forced:wn},{all:function(e){var t=this,r=pn(t),n=r.resolve,i=r.reject,a=rn((function(){var r=tt(t.resolve),a=[],o=0,s=1;ar(e,(function(e){var c=o++,u=!1;a.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,a[c]=e,--s||n(a))}),i)})),--s||n(a)}));return a.error&&i(a.value),r.promise},race:function(e){var t=this,r=pn(t),n=r.reject,i=rn((function(){var i=tt(t.resolve);ar(e,(function(e){i.call(t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var Ln=function(){var e=T(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function Pn(e,t){return RegExp(e,t)}var Sn,Cn,Fn={UNSUPPORTED_Y:a((function(){var e=Pn("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:a((function(){var e=Pn("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Nn=RegExp.prototype.exec,In=String.prototype.replace,jn=Nn,Gn=(Sn=/a/,Cn=/b*/g,Nn.call(Sn,"a"),Nn.call(Cn,"a"),0!==Sn.lastIndex||0!==Cn.lastIndex),Vn=Fn.UNSUPPORTED_Y||Fn.BROKEN_CARET,Un=void 0!==/()??/.exec("")[1];(Gn||Un||Vn)&&(jn=function(e){var t,r,n,i,a=this,o=Vn&&a.sticky,s=Ln.call(a),c=a.source,u=0,l=e;return o&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),l=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(c="(?: "+c+")",l=" "+l,u++),r=new RegExp("^(?:"+c+")",s)),Un&&(r=new RegExp("^"+c+"$(?!\\s)",s)),Gn&&(t=a.lastIndex),n=Nn.call(o?r:a,l),o?n?(n.input=n.input.slice(u),n[0]=n[0].slice(u),n.index=a.lastIndex,a.lastIndex+=n[0].length):a.lastIndex=0:Gn&&n&&(a.lastIndex=a.global?n.index+n[0].length:t),Un&&n&&n.length>1&&In.call(n[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(n[i]=void 0)})),n});var Dn=jn;Pe({target:"RegExp",proto:!0,forced:/./.exec!==Dn},{exec:Dn});var Hn=Ue("species"),Kn=!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),zn="$0"==="a".replace(/./,"$0"),Bn=Ue("replace"),Yn=!!/./[Bn]&&""===/./[Bn]("a","$0"),$n=!a((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),Wn=function(e,t,r,n){var i=Ue(e),o=!a((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=o&&!a((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Hn]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!o||!s||"replace"===e&&(!Kn||!zn||Yn)||"split"===e&&!$n){var c=/./[i],u=r(i,""[e],(function(e,t,r,n,i){return t.exec===Dn?o&&!i?{done:!0,value:c.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}),{REPLACE_KEEPS_$0:zn,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Yn}),l=u[0],_=u[1];re(String.prototype,e,l),re(RegExp.prototype,i,2==t?function(e,t){return _.call(e,this,t)}:function(e){return _.call(e,this)})}n&&L(RegExp.prototype[i],"sham",!0)},qn=function(e){return function(t,r){var n,i,a=String(p(t)),o=ce(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=a.charCodeAt(o))<55296||n>56319||o+1===s||(i=a.charCodeAt(o+1))<56320||i>57343?e?a.charAt(o):n:e?a.slice(o,o+2):i-56320+(n-55296<<10)+65536}},Xn={codeAt:qn(!1),charAt:qn(!0)}.charAt,Zn=function(e,t,r){return t+(r?Xn(e,t).length:1)},Jn=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==h(e))throw TypeError("RegExp#exec called on incompatible receiver");return Dn.call(e,t)},Qn=Math.max,ei=Math.min,ti=Math.floor,ri=/\$([$&'`]|\d\d?|<[^>]*>)/g,ni=/\$([$&'`]|\d\d?)/g,ii=function(e){return void 0===e?e:String(e)};Wn("replace",2,(function(e,t,r,n){var i=n.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,a=n.REPLACE_KEEPS_$0,o=i?"$":"$0";return[function(r,n){var i=p(this),a=null==r?void 0:r[e];return void 0!==a?a.call(r,i,n):t.call(String(i),r,n)},function(e,n){if(!i&&a||"string"==typeof n&&-1===n.indexOf(o)){var c=r(t,e,this,n);if(c.done)return c.value}var u=T(e),l=String(this),_="function"==typeof n;_||(n=String(n));var h=u.global;if(h){var f=u.unicode;u.lastIndex=0}for(var d=[];;){var p=Jn(u,l);if(null===p)break;if(d.push(p),!h)break;""===String(p[0])&&(u.lastIndex=Zn(l,le(u.lastIndex),f))}for(var v="",m=0,g=0;g<d.length;g++){p=d[g];for(var y=String(p[0]),w=Qn(ei(ce(p.index),l.length),0),E=[],M=1;M<p.length;M++)E.push(ii(p[M]));var b=p.groups;if(_){var A=[y].concat(E,w,l);void 0!==b&&A.push(b);var x=String(n.apply(void 0,A))}else x=s(y,l,w,E,b,n);w>=m&&(v+=l.slice(m,w)+x,m=w+y.length)}return v+l.slice(m)}];function s(e,r,n,i,a,o){var s=n+e.length,c=i.length,u=ni;return void 0!==a&&(a=Ce(a),u=ri),t.call(o,u,(function(t,o){var u;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,n);case"'":return r.slice(s);case"<":u=a[o.slice(1,-1)];break;default:var l=+o;if(0===l)return t;if(l>c){var _=ti(l/10);return 0===_?t:_<=c?void 0===i[_-1]?o.charAt(1):i[_-1]+o.charAt(1):t}u=i[l-1]}return void 0===u?"":u}))}}));var ai=Ue("match"),oi=[].push,si=Math.min,ci=!a((function(){return!RegExp(4294967295,"y")}));Wn("split",2,(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(p(this)),i=void 0===r?4294967295:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!function(e){var t;return m(e)&&(void 0!==(t=e[ai])?!!t:"RegExp"==h(e))}(e))return t.call(n,e,i);for(var a,o,s,c=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,_=new RegExp(e.source,u+"g");(a=Dn.call(_,n))&&!((o=_.lastIndex)>l&&(c.push(n.slice(l,a.index)),a.length>1&&a.index<n.length&&oi.apply(c,a.slice(1)),s=a[0].length,l=o,c.length>=i));)_.lastIndex===a.index&&_.lastIndex++;return l===n.length?!s&&_.test("")||c.push(""):c.push(n.slice(l)),c.length>i?c.slice(0,i):c}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var i=p(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,r):n.call(String(i),t,r)},function(e,i){var a=r(n,e,this,i,n!==t);if(a.done)return a.value;var o=T(e),s=String(this),c=dr(o,RegExp),u=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(ci?"y":"g"),_=new c(ci?o:"^(?:"+o.source+")",l),h=void 0===i?4294967295:i>>>0;if(0===h)return[];if(0===s.length)return null===Jn(_,s)?[s]:[];for(var f=0,d=0,p=[];d<s.length;){_.lastIndex=ci?d:0;var v,m=Jn(_,ci?s:s.slice(d));if(null===m||(v=si(le(_.lastIndex+(ci?0:d)),s.length))===f)d=Zn(s,d,u);else{if(p.push(s.slice(f,d)),p.length===h)return p;for(var g=1;g<=m.length-1;g++)if(p.push(m[g]),p.length===h)return p;d=f=v}}return p.push(s.slice(f)),p}]}),!ci);r((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof _?t:_,a=Object.create(i.prototype),o=new b(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return x()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function _(){}function h(){}function f(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(A([])));v&&v!==t&&r.call(v,i)&&(d=v);var m=f.prototype=_.prototype=Object.create(d);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,s){var c=u(e[i],e,a);if("throw"!==c.type){var l=c.arg,_=l.value;return _&&"object"==typeof _&&r.call(_,"__await")?t.resolve(_.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(_).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=m.constructor=f,f.constructor=h,h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(y.prototype),y.prototype[a]=function(){return this},e.AsyncIterator=y,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new y(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),s(m,o,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function ui(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function li(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _i(e){return(_i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hi(e,t){return(hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fi(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var di=e.GeoMath,pi=e.GeoPoint,vi=function(t){function r(t,n,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(a=fi(this,_i(r).call(this))).createViewer(t,n,i),a._camera_parameter={latitude:0,longitude:0,height:0,pitch:0,yaw:0,fov:0,near:0,far:0},a._operation_mode=r.OperationMode.NONE,a._mouse_down_position=di.createVector2f(),a._pre_mouse_position=di.createVector2f(),a._rotate_center=di.createVector3(),a._translate_drag=di.createVector2f(),a._translate_eye_drag=di.createVector2f(),a._rotate_drag=di.createVector2f(),a._free_rotate_drag=di.createVector2f(),a._height_drag=di.createVector2f(),a._zoom_wheel=0,a._fovy_key=0,a._default_fov=r.DEFAULT_CAMERA_PARAMETER.fov,a._key_mode=!1,a._update_url_hash=!1,a._update_url_hash_full_digits=!1,a._last_camera_parameter={latitude:-1,longitude:-1,height:0,pitch:0,yaw:0,fov:0,near:0,far:0},a._viewerCameraMode=r.CameraMode.CAMERA_FREE,a._animation=new e.animation.EasyBindingBlock,a._updater=new e.animation.Updater,a._curve_move=null,a._curve_rotation=null,a._flycamera_total_time=0,a._flycamera_target_time=0,a._flyPosition=new e.GeoPoint(0,0,0),a._flyRotation=di.setIdentity(di.createMatrix()),a._initCameraParameter(i),a}var n,i,a,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(r,t),n=r,(i=[{key:"createViewer",value:function(t,r,n){this._viewer&&this.destroy(),this._viewer=new e.Viewer(t,{dem_provider:this._createDemProvider(r,n),image_provider:this._createImageProvider(n),layers:n&&n.layers||null,render_callback:this,ground_visibility:!n||void 0===n.ground_visibility||n.ground_visibility,entity_visibility:!n||void 0===n.entity_visibility||n.entity_visibility,render_mode:n&&n.render_mode||e.Viewer.RenderMode.SURFACE,debug_stats:n&&n.debug_stats||null,attribution_controller:n&&n.attribution_controller||null});var i=this._viewer._canvas_element;return i.setAttribute("oncontextmenu","return false;"),i.setAttribute("tabindex","0"),this._addEventListener(),this._viewer}},{key:"destroy",value:function(){this._viewer&&(this._removeEventListener(),this._viewer.destroy(),this._viewer=null)}},{key:"_createDemProvider",value:function(t,r){return r&&r.dem_provider||new e.CloudDemProvider(t)}},{key:"_createImageProvider",value:function(t){return t&&t.image_provider||new e.StandardImageProvider("https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/",".jpg",256,2,18)}},{key:"_initCameraParameter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.camera_position||r.DEFAULT_CAMERA_POSITION,n=e.lookat_position||r.DEFAULT_LOOKAT_POSITION,i=e.camera_parameter||r.DEFAULT_CAMERA_PARAMETER;this.setCameraPosition(t),this.setLookAtPosition(n),this.setCameraParameter(i),this._updateViewerCamera()}},{key:"initCameraParameterFromURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.camera_position||r.DEFAULT_CAMERA_POSITION,n=e.lookat_position||r.DEFAULT_LOOKAT_POSITION,i=e.camera_parameter||r.DEFAULT_CAMERA_PARAMETER,a=0;e.url_update&&this.setURLUpdate(e.url_update);var o=this._extractURLParameter();o&&(t=o.camera_position,n=o.lookat_position,a=o.yaw),this.setCameraPosition(t),this.setLookAtPosition(n,a),this.setCameraParameter(i),this._updateViewerCamera()}},{key:"_extractURLParameter",value:function(){var e=window.location.hash;if(0!==e.length){var t=(e=e.slice(1)).split("/");if(!(t.length<2)){var r=parseFloat(t[0]);if("number"==typeof r&&isFinite(r)){var n=r;if("number"==typeof(r=parseFloat(t[1]))&&isFinite(r)){for(var i=r,a=8e3,o=1e3,s=0,c=0,u=2;t.length>u;u++){var l=t[u],_=this._getURLParameterValue(l);if(!isNaN(_))switch(l.slice(-1)){case"a":a=_;break;case"t":s=_;break;case"r":o=_;break;case"h":c=_}}var h=s*di.DEGREE,f=o*Math.cos(h),d=o*Math.sin(h),p=this._destination(i,n,d,c);return{camera_position:{height:a+f,longitude:p.longitude,latitude:p.latitude},lookat_position:{height:a,longitude:i,latitude:n},yaw:c}}}}}}},{key:"_getURLParameterValue",value:function(e){var t=parseFloat(e);return"number"==typeof t&&isFinite(t)?t:NaN}},{key:"_addEventListener",value:function(){var e=this._viewer._canvas_element;this._onBlur=this._onBlur.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),window.addEventListener("blur",this._onBlur,{passive:!1}),e.addEventListener("mousedown",this._onMouseDown,{passive:!0}),e.addEventListener("mousemove",this._onMouseMove,{passive:!0}),document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),e.addEventListener("mouseup",this._onMouseUp,{passive:!0}),document.addEventListener("mouseup",this._onMouseUp,{capture:!1}),e.addEventListener("wheel",this._onMouseWheel,{passive:!1}),e.addEventListener("keydown",this._onKeyDown,{capture:!1,passive:!1}),e.addEventListener("keyup",this._onKeyUp,{passive:!0})}},{key:"_removeEventListener",value:function(){var e=this._viewer._canvas_element;window.removeEventListener("blur",this._onBlur,{passive:!1}),e.removeEventListener("mousedown",this._onMouseDown,{passive:!0}),e.removeEventListener("mousemove",this._onMouseMove,{passive:!0}),document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),e.removeEventListener("mouseup",this._onMouseUp,{passive:!0}),document.removeEventListener("mouseup",this._onMouseUp,{capture:!1}),e.removeEventListener("wheel",this._onMouseWheel,{passive:!1}),e.removeEventListener("keydown",this._onKeyDown,{capture:!1,passive:!1}),e.removeEventListener("keyup",this._onKeyUp,{passive:!0})}},{key:"onStart",value:function(){}},{key:"onStop",value:function(){}},{key:"onUpdateFrame",value:function(e){this._viewerCameraMode===r.CameraMode.CAMERA_FLY?this.updateFlyCamera(e):(this._translation(e),this._rotation(),this._freeRotation(e),this._translationOfHeight(),this._translationOfEyeDirection(),this._changeFovy(),this._correctAltitude(),this._updateClipPlane(),this._updateViewerCamera())}},{key:"_updateViewerCamera",value:function(){var e=this._viewer.camera,t=new pi(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(di.createMatrix()),r=di.rotation_matrix([1,0,0],this._camera_parameter.pitch,di.createMatrix()),n=di.rotation_matrix([0,0,1],this._camera_parameter.yaw,di.createMatrix()),i=di.mul_AA(n,r,di.createMatrix());e.view_to_gocs=di.mul_AA(t,i,di.createMatrix()),e.fov=this._camera_parameter.fov,e.near=this._camera_parameter.near,e.far=this._camera_parameter.far,this._updateURLHash()}},{key:"setURLUpdate",value:function(e){this._update_url_hash=e}},{key:"_updateURLHash",value:function(){if(this._update_url_hash&&this._operation_mode===r.OperationMode.NONE&&(this._last_camera_parameter.latitude!==this._camera_parameter.latitude||this._last_camera_parameter.longitude!==this._camera_parameter.longitude||this._last_camera_parameter.height!==this._camera_parameter.height||this._last_camera_parameter.pitch!==this._camera_parameter.pitch||this._last_camera_parameter.yaw!==this._camera_parameter.yaw)){var t=this._viewer.canvas_element,n=[t.width/2,t.height/2],i=this.viewer.camera.getCanvasRay(n,new e.Ray),a=this.viewer.getRayIntersection(i);if(null!=a){var o=new e.GeoPoint;o.setFromGocs(a);var s,c,u,l,_,h,f,d=this._viewer.getElevation(o.latitude,o.longitude),p=new e.GeoPoint(o.longitude,o.latitude,d).getAsGocs(di.createVector3()),v=this._viewer.camera,m=v.view_to_gocs[12]-p[0],g=v.view_to_gocs[13]-p[1],y=v.view_to_gocs[14]-p[2],w=Math.sqrt(m*m+g*g+y*y);this._update_url_hash_full_digits?(c=o.latitude,u=o.longitude,l=d,_=this._camera_parameter.pitch,h=w,f=this._camera_parameter.yaw):(c=o.latitude.toFixed(10),u=o.longitude.toFixed(10),l=d.toFixed(5),_=this._camera_parameter.pitch.toFixed(5),h=w.toFixed(5),f=this._camera_parameter.yaw.toFixed(5)),s="#".concat(c,"/").concat(u,"/").concat(l,"a/").concat(_,"t/").concat(h,"r/").concat(f,"h"),this._last_camera_parameter.latitude=this._camera_parameter.latitude,this._last_camera_parameter.longitude=this._camera_parameter.longitude,this._last_camera_parameter.height=this._camera_parameter.height,this._last_camera_parameter.pitch=this._camera_parameter.pitch,this._last_camera_parameter.yaw=this._camera_parameter.yaw;var E=window.location.href.replace(window.location.hash,s);window.location.replace(E)}}}},{key:"_updateClipPlane",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude),t=Math.max(this._camera_parameter.height-e,r.MINIMUM_HEIGHT);this._camera_parameter.near=Math.max(t*r.NEAR_FACTOR,r.MINIMUM_NEAR),this._camera_parameter.far=Math.max(this._camera_parameter.near*r.FAR_FACTOR,r.MINIMUM_FAR)}},{key:"_correctAltitude",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude);this._camera_parameter.height=Math.max(this._camera_parameter.height,e+r.MINIMUM_HEIGHT)}},{key:"resetOpEvent",value:function(){this._resetEventParameter()}},{key:"onBlur",value:function(e){this._resetEventParameter()}},{key:"_onBlur",value:function(e){this.onBlur(e)}},{key:"onMouseDown",value:function(e,t){if(this._mouse_down_position=e,this._pre_mouse_position=e,0===t.button)if(t.shiftKey){this._operation_mode=r.OperationMode.ROTATE;var n=this._viewer.camera.getCanvasRay(this._mouse_down_position);this._rotate_center=this._viewer.getRayIntersection(n)}else t.ctrlKey?this._operation_mode=r.OperationMode.FREE_ROTATE:this._operation_mode=r.OperationMode.TRANSLATE;else 1===t.button?(this._operation_mode=r.OperationMode.ROTATE,n=this._viewer.camera.getCanvasRay(this._mouse_down_position),this._rotate_center=this._viewer.getRayIntersection(n)):2===t.button&&(this._operation_mode=t.shiftKey?r.OperationMode.HEIGHT_TRANSLATE:r.OperationMode.EYE_TRANSLATE)}},{key:"_onMouseDown",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseDown(t,e)}},{key:"onMouseMove",value:function(e,t){var n=e;this._operation_mode===r.OperationMode.TRANSLATE?(this._translate_drag[0]+=n[0]-this._pre_mouse_position[0],this._translate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.ROTATE?(this._rotate_drag[0]+=n[0]-this._pre_mouse_position[0],this._rotate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.FREE_ROTATE?(this._free_rotate_drag[0]+=n[0]-this._pre_mouse_position[0],this._free_rotate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.HEIGHT_TRANSLATE?(this._translate_drag[0]+=n[0]-this._pre_mouse_position[0],this._height_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.EYE_TRANSLATE&&(this._translate_eye_drag[1]+=n[1]-this._pre_mouse_position[1]),this._pre_mouse_position=n}},{key:"_onMouseMove",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseMove(t,e)}},{key:"onMouseUp",value:function(e,t){this._resetEventParameter()}},{key:"_onMouseUp",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseUp(t,e)}},{key:"onMouseWheel",value:function(e,t){var n;(t.preventDefault(),this._viewerCameraMode==r.CameraMode.CAMERA_FREE)&&(this._mouse_down_position=e,n=-1*Math.sign(t.deltaY)*Math.ceil(Math.abs(t.deltaY)/100),this._zoom_wheel+=n)}},{key:"_onMouseWheel",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseWheel(t,e)}},{key:"onKeyDown",value:function(e){switch(e.key){case"c":case"C":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=1;break;case"z":case"Z":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=-1;break;case"x":case"X":this._camera_parameter.fov=this._default_fov;break;case"ArrowUp":e.preventDefault();var t=[(n=this._viewer.canvas_element).width/2,n.height/2];this._mouse_down_position=t,this._translate_drag[1]=100,this._key_mode=!0;break;case"ArrowDown":var n;e.preventDefault(),t=[(n=this._viewer.canvas_element).width/2,n.height/2],this._mouse_down_position=t,this._translate_drag[1]=-100,this._key_mode=!0;break;case"ArrowLeft":e.preventDefault(),this._free_rotate_drag[0]=100,this._key_mode=!0;break;case"ArrowRight":e.preventDefault(),this._free_rotate_drag[0]=-100,this._key_mode=!0}}},{key:"_onKeyDown",value:function(e){this.onKeyDown(e)}},{key:"onKeyUp",value:function(e){switch(e.key){case"c":case"C":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"z":case"Z":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"ArrowUp":case"ArrowDown":this._operation_mode=r.OperationMode.NONE,this._translate_drag[1]=0,this._key_mode=!1;break;case"ArrowLeft":case"ArrowRight":this._operation_mode=r.OperationMode.NONE,this._free_rotate_drag[0]=0,this._key_mode=!1}}},{key:"_onKeyUp",value:function(e){this.onKeyUp(e)}},{key:"_resetEventParameter",value:function(){this._translate_drag[0]=0,this._translate_drag[1]=0,this._rotate_drag[0]=0,this._rotate_drag[1]=0,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0,this._height_drag[0]=0,this._height_drag[1]=0,this._operation_mode=r.OperationMode.NONE}},{key:"_translation",value:function(t){if(0!=this._translate_drag[0]||0!=this._translate_drag[1]){this._key_mode&&(this._translate_drag[0]*=t,this._translate_drag[1]*=t);var r=this._viewer.camera,n=r.getCanvasRay(this._mouse_down_position),i=this._viewer.getRayIntersection(n),a=[this._mouse_down_position[0]+this._translate_drag[0],this._mouse_down_position[1]+this._translate_drag[1]];n=r.getCanvasRay(a);var o=this._viewer.getRayIntersection(n);if(null==i||null==o)return;var s=new e.GeoPoint;s.setFromGocs(i);var c=new e.GeoPoint;c.setFromGocs(o);var u=Math.pow(this._getVectorLength(n.direction),2),l=2*di.dot3(n.position,n.direction),_=l*l-4*u*(Math.pow(this._getVectorLength(n.position),2)-Math.pow(s.altitude+di.EARTH_RADIUS,2));if(s.altitude<this._camera_parameter.height&&c.altitude<this._camera_parameter.height&&_>0){var h=(-l+Math.sqrt(_))/2*u,f=(-l-Math.sqrt(_))/2*u,d=Math.min(h,f);o[0]=n.position[0]+d*n.direction[0],o[1]=n.position[1]+d*n.direction[1],o[2]=n.position[2]+d*n.direction[2],c.setFromGocs(o)}var p=c.latitude-s.latitude,v=c.longitude-s.longitude;this._camera_parameter.latitude-=p,this._camera_parameter.longitude-=v,this._translate_drag[0]=0,this._translate_drag[1]=0,this._mouse_down_position=this._pre_mouse_position}}},{key:"_rotation",value:function(){if(0!=this._rotate_drag[0]||0!=this._rotate_drag[1]){if(null==this._rotate_center)return this._rotate_drag[0]=0,void(this._rotate_drag[1]=0);var t=this._viewer.camera,r=di.createVector3();r[0]=t.view_to_gocs[12]-this._rotate_center[0],r[1]=t.view_to_gocs[13]-this._rotate_center[1],r[2]=t.view_to_gocs[14]-this._rotate_center[2];var n=new e.GeoPoint;n.setFromGocs(this._rotate_center);var i=n.getMlocsToGocsMatrix(di.createMatrix()),a=di.createVector3();a[0]=i[8],a[1]=i[9],a[2]=i[10],a=di.normalize3(a,di.createVector3());var o=-this._rotate_drag[0]/10,s=-this._rotate_drag[1]/10,c=this._rotateVector(r,a,o),u=di.clamp(this._camera_parameter.pitch+s,0,90);u!=this._camera_parameter.pitch&&(a[0]=t.view_to_gocs[0],a[1]=t.view_to_gocs[1],a[2]=t.view_to_gocs[2],c=this._rotateVector(c,a,s));var l=di.createVector3();l[0]=this._rotate_center[0]+c[0],l[1]=this._rotate_center[1]+c[1],l[2]=this._rotate_center[2]+c[2];var _=new e.GeoPoint;_.setFromGocs(l),this._camera_parameter.latitude=_.latitude,this._camera_parameter.longitude=_.longitude,this._camera_parameter.height=_.altitude,this._camera_parameter.yaw+=o,this._camera_parameter.pitch=u,this._rotate_drag[0]=0,this._rotate_drag[1]=0}}},{key:"_freeRotation",value:function(e){if(0!=this._free_rotate_drag[0]||0!=this._free_rotate_drag[1]){this._key_mode&&(this._free_rotate_drag[0]*=e,this._free_rotate_drag[1]*=e);var t=this._free_rotate_drag[0]/10,r=this._free_rotate_drag[1]/10,n=di.clamp(this._camera_parameter.pitch+r,0,90);this._camera_parameter.yaw+=t,this._camera_parameter.pitch=n,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0}}},{key:"_translationOfHeight",value:function(){if(0!=this._height_drag[0]||0!=this._height_drag[1]){var e=100*this._height_drag[1]*(di.gudermannian((this._camera_parameter.height-5e4)/1e4)+Math.PI/2);this._camera_parameter.height+=e,this._height_drag[0]=0,this._height_drag[1]=0}}},{key:"_translationOfEyeDirection",value:function(){var t=0;if(0!=this._zoom_wheel?(t=Math.pow(.9,this._zoom_wheel),this._zoom_wheel=0):0!=this._translate_eye_drag[1]&&(t=Math.pow(.995,this._translate_eye_drag[1]),this._translate_eye_drag[1]=0),0!==t){var n=this._viewer.camera,i=n.getCanvasRay(this._mouse_down_position),a=this._viewer.getRayIntersection(i);if(null==a)return;var o=new e.GeoPoint;o.setFromGocs(a);var s=di.createVector3();s[0]=(a[0]-n.view_to_gocs[12])*t,s[1]=(a[1]-n.view_to_gocs[13])*t,s[2]=(a[2]-n.view_to_gocs[14])*t;var c=di.createVector3();c[0]=a[0]-s[0],c[1]=a[1]-s[1],c[2]=a[2]-s[2];var u=new e.GeoPoint;u.setFromGocs(c);var l=this._viewer.getElevation(u.latitude,u.longitude);if(l+r.MINIMUM_HEIGHT>u.altitude){var _=u.altitude-(l+r.MINIMUM_HEIGHT),h=o.getUpwardVector(di.createVector3()),f=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),d=di.dot3(s,h)/f;di.scale3(1-_/d/f,s,s),c[0]=a[0]-s[0],c[1]=a[1]-s[1],c[2]=a[2]-s[2],u.setFromGocs(c)}this._camera_parameter.latitude=u.latitude,this._camera_parameter.longitude=u.longitude,this._camera_parameter.height=u.altitude,this._zoom_wheel=0}}},{key:"_changeFovy",value:function(){var e=Math.tan(.5*this._camera_parameter.fov*di.DEGREE),t=2*Math.atan(e*Math.pow(r.FOV_FACTOR,-this._fovy_key)),n=r.FOV_RANGE;this._camera_parameter.fov=di.clamp(t/di.DEGREE,n.min,n.max),this._fovy_key=0}},{key:"setCameraPosition",value:function(e){this._camera_parameter.latitude=e.latitude,this._camera_parameter.longitude=e.longitude,this._camera_parameter.height=e.height,this._camera_parameter.height<r.MINIMUM_HEIGHT&&(this._camera_parameter.height=r.MINIMUM_HEIGHT)}},{key:"_isSame",value:function(e,t,r){var n=r||1e-6;return Math.abs(e-t)<n}},{key:"setLookAtPosition",value:function(e,t){if(this._isSame(this._camera_parameter.longitude,e.longitude)&&this._isSame(this._camera_parameter.latitude,e.latitude))return this._camera_parameter.yaw=t||0,void(this._camera_parameter.pitch=0);var r=new pi(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(di.createMatrix()),n=di.createVector3();n[0]=r[4],n[1]=r[5],n[2]=r[6];var i=new pi(e.longitude,e.latitude,e.height).getMlocsToGocsMatrix(di.createMatrix()),a=di.createVector3();a[0]=i[12]-r[12],a[1]=i[13]-r[13],a[2]=i[14]-r[14],n=di.normalize3(n,di.createVector3()),a=di.normalize3(a,di.createVector3());var o=di.createVector3();o[0]=r[8],o[1]=r[9],o[2]=r[10];var s=this._calculateAngle(o,n,a);this._camera_parameter.yaw=s;var c=di.createVector3();c[0]=r[8],c[1]=r[9],c[2]=r[10];var u=di.createVector3();u[0]=r[0],u[1]=r[1],u[2]=r[2],o=this._rotateVector(u,o,s),a[0]=-1*a[0],a[1]=-1*a[1],a[2]=-1*a[2],this._camera_parameter.pitch=di.clamp(Math.abs(this._calculateAngle(o,c,a)),0,90)}},{key:"setCameraParameter",value:function(e){e.fov&&(this._camera_parameter.fov=e.fov,this._default_fov=e.fov),e.near&&(this._camera_parameter.near=e.near),e.far&&(this._camera_parameter.far=e.far),e.speed_factor&&(this._camera_parameter.speed_factor=e.speed_factor)}},{key:"getLayer",value:function(e){return this._viewer.layers.getLayer(e)}},{key:"getLayerNum",value:function(){return this._viewer.layers.num_layers()}},{key:"addLayer",value:function(e){this._viewer.layers.add(e)}},{key:"insertLayer",value:function(e,t){this._viewer.layers.insert(e,t)}},{key:"removeLayer",value:function(e){this._viewer.layers.remove(e)}},{key:"clearLayer",value:function(){this._viewer.layers.clear()}},{key:"getEntity",value:function(e){return this._viewer.scene.getEntity(e)}},{key:"getEntityNum",value:function(){return this._viewer.scene.num_entities()}},{key:"addEntity",value:function(e){this._viewer.scene.addEntity(e)}},{key:"removeEntity",value:function(e){this._viewer.scene.removeEntity(e)}},{key:"clearEntity",value:function(){this._viewer.scene.clearEntity()}},{key:"_getVectorLength",value:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))}},{key:"_rotateVector",value:function(e,t,r){var n=di.rotation_matrix(t,r,di.createMatrix()),i=di.createVector3();return i[0]=e[0]*n[0]+e[1]*n[4]+e[2]*n[8]+n[12],i[1]=e[0]*n[1]+e[1]*n[5]+e[2]*n[9]+n[13],i[2]=e[0]*n[2]+e[1]*n[6]+e[2]*n[10]+n[14],i}},{key:"_calculateAngle",value:function(e,t,r){for(var n=di.createVector3(),i=di.dot3(e,t),a=0;a<3;a++)n[a]=t[a]-i*e[a];var o=di.createVector3();for(i=di.dot3(e,r),a=0;a<3;a++)o[a]=r[a]-i*e[a];if(di.normalize3(n,n),di.normalize3(o,o),Math.abs(this._getVectorLength(n)<1e-6)||Math.abs(this._getVectorLength(o)<1e-6))s=0;else{var s=Math.acos(di.clamp(di.dot3(n,o)/(this._getVectorLength(n)*this._getVectorLength(o)),-1,1))/di.DEGREE,c=di.cross3(n,o,di.createVector3());c=di.normalize3(c,di.createVector3()),di.dot3(e,c)<0&&(s*=-1)}return s}},{key:"_mousePos",value:function(e,t){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}},{key:"startFlyCamera",value:(o=regeneratorRuntime.mark((function e(t){var n,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._viewerCameraMode===r.CameraMode.CAMERA_FREE){e.next=2;break}return e.abrupt("return");case 2:if(t.time&&t.iscs_end){e.next=4;break}return e.abrupt("return");case 4:return this._flycamera_total_time=0,this._flycamera_target_time=t.time,n=this.createFlyCurve(t),this._curve_move=n.move,this._curve_rotation=n.rotation,this._setupAnimationBindingBlock(),this._animation.bind("position",this._updater,this._curve_move),this._animation.bind("orientation",this._updater,this._curve_rotation),this._update_url_hash_backup=this._update_url_hash,this._update_url_hash=!1,this._viewerCameraMode=r.CameraMode.CAMERA_FLY,e.next=17,new Promise((function(e,t){i._flycamera_on_success=e}));case 17:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=o.apply(e,t);function a(e){ui(i,r,n,a,s,"next",e)}function s(e){ui(i,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return s.apply(this,arguments)})},{key:"_calculateKeyPoint",value:function(t){var r={fly_iscs_start:t.iscs_start||null,fly_iscs_end:null,target_angle:0,start_top:null,end_top:null,heading:0,tilt:0,roll:0};if(null==t.iscs_start){var n=this._viewer.camera.view_to_gocs;r.fly_iscs_start=(new e.GeoPoint).setFromGocs(e.GeoMath.createVector3([n[12],n[13],n[14]]))}var i=t.end_from_lookat||2e4,a=t.end_altitude||2e4,o=t.target_clamp||!0,s=this._destination(t.iscs_end.longitude,t.iscs_end.latitude,i,0);r.fly_iscs_end=new e.GeoPoint(s.longitude,s.latitude,a);var c=this._viewer.getElevation.bind(this._viewer);c&&(r.fly_iscs_end.altitude+=c(r.fly_iscs_end.latitude,r.fly_iscs_end.longitude));var u=t.iscs_end;c&&o&&(u.altitude=c(u.latitude,u.longitude)),r.target_angle=this._getLookAtAngle(r.fly_iscs_end,u);var l=new e.GeoPoint(r.fly_iscs_start.longitude,r.fly_iscs_start.latitude,0),_=new e.GeoPoint(t.iscs_end.longitude,t.iscs_end.latitude,0),h=l.getGeographicalDistance(_);return h>12e5&&(h=12e5),r.start_top=new e.GeoPoint(r.fly_iscs_start.longitude,r.fly_iscs_start.latitude,r.fly_iscs_end.altitude+h),r.end_top=new e.GeoPoint(r.fly_iscs_end.longitude,r.fly_iscs_end.latitude,r.fly_iscs_end.altitude+h),r.heading=this._camera_parameter.yaw,r.tilt=this._camera_parameter.pitch,r.roll=0,this.setCameraParameter({near:30,far:1e7}),r}},{key:"createFlyCurve",value:function(t){var r=this._calculateKeyPoint(t),n=[],i=[],a=new e.animation.KFLinearCurve(e.animation.Type.find("vector3")),o=new e.animation.KFLinearCurve(e.animation.Type.find("vector3")),s=r.fly_iscs_start,c=r.fly_iscs_end,u=this._flycamera_target_time/3,l=!0;return s.altitude>r.start_top.altitude&&(l=!1),n.push(e.animation.Time.fromNumber(0)),n.push(e.GeoMath.createVector3([s.longitude,s.latitude,s.altitude])),l&&(n.push(e.animation.Time.fromNumber(u)),n.push(e.GeoMath.createVector3([r.start_top.longitude,r.start_top.latitude,r.start_top.altitude])),n.push(e.animation.Time.fromNumber(2*u)),n.push(e.GeoMath.createVector3([r.end_top.longitude,r.end_top.latitude,r.end_top.altitude]))),n.push(e.animation.Time.fromNumber(this._flycamera_target_time)),n.push(e.GeoMath.createVector3([c.longitude,c.latitude,c.altitude])),a.setKeyFrames(n),i.push(e.animation.Time.fromNumber(0)),i.push(e.GeoMath.createVector3([r.heading,r.tilt,r.roll])),l&&(i.push(e.animation.Time.fromNumber(u)),i.push(e.GeoMath.createVector3([r.heading,10,r.roll])),i.push(e.animation.Time.fromNumber(2*u)),i.push(e.GeoMath.createVector3([r.heading,10,r.roll]))),i.push(e.animation.Time.fromNumber(this._flycamera_target_time)),i.push(e.GeoMath.createVector3([r.target_angle.heading,-1*r.target_angle.tilt,this._roll])),o.setKeyFrames(i),{move:a,rotation:o}}},{key:"updateFlyCamera",value:function(t){this._flycamera_total_time+=t,this._updater.update(e.animation.Time.fromNumber(this._flycamera_total_time)),this._flycamera_total_time>=this._flycamera_target_time&&this.onEndFlyCamera()}},{key:"onEndFlyCamera",value:function(){this._animation.unbind("position"),this._animation.unbind("orientation"),this._curve_move=null,this._curve_rotation=null,this._update_url_hash=this._update_url_hash_backup,this._viewerCameraMode=r.CameraMode.CAMERA_FREE,this._resetEventParameter(),this._flycamera_on_success(),this._flycamera_on_success=null}},{key:"_setupAnimationBindingBlock",value:function(){var t=this,r=this._animation,n=e.animation.Type.find("vector3");r.addEntry("position",[n],null,(function(e){t.setCameraPosition({longitude:e[0],latitude:e[1],height:e[2]})})),r.addEntry("orientation",[n],null,(function(e){t._camera_parameter.yaw=e[0],t._camera_parameter.pitch=e[1],t._updateViewerCamera()}))}},{key:"_getLookAtAngle",value:function(e,t){var r=e.getMlocsToGocsMatrix(di.createMatrix()),n=di.createVector3([r[4],r[5],r[6]]);n=di.normalize3(n,di.createVector3());var i=t.getMlocsToGocsMatrix(di.createMatrix()),a=di.createVector3([i[12]-r[12],i[13]-r[13],i[14]-r[14]]);a=di.normalize3(a,di.createVector3());var o=di.createVector3([r[8],r[9],r[10]]),s=this._calculateAngle(o,n,a),c=di.createVector3([r[8],r[9],r[10]]),u=di.createVector3([r[0],r[1],r[2]]);return a[0]=-1*a[0],a[1]=-1*a[1],a[2]=-1*a[2],{heading:s,tilt:-1*di.clamp(Math.abs(this._calculateAngle(u,c,a)),0,90)}}},{key:"_destination",value:function(t,r,n,i){var a=-(180-i)*di.DEGREE,o=-n*Math.sin(a),s=n*Math.cos(a),c=new e.GeoPoint(t,r,0).getMlocsToGocsMatrix(di.createMatrix()),u=o*c[0]+s*c[4]+c[12],l=o*c[1]+s*c[5]+c[13],_=o*c[2]+s*c[6]+c[14],h=new e.GeoPoint;return h.setFromGocs([u,l,_]),h}},{key:"viewer",get:function(){return this._viewer}}])&&li(n.prototype,i),a&&li(n,a),r}(e.RenderCallback);return vi.OperationMode={NONE:"NONE",TRANSLATE:"TRANSLATE",ROTATE:"ROTATE",FREE_ROTATE:"FREE_ROTATE",EYE_TRANSLATE:"EYE_TRANSLATE",HEIGHT_TRANSLATE:"HEIGHT_TRANSLATE",CHANGE_FOVY:"CHANGE_FOVY"},vi.CameraMode={NONE:"NONE",CAMERA_FREE:"CAMERA_FREE",CAMERA_FLY:"CAMERA_FLY"},vi.DEFAULT_CAMERA_POSITION={latitude:35.475968,longitude:138.573161,height:2e3},vi.DEFAULT_LOOKAT_POSITION={latitude:35.360626,longitude:138.727363,height:2e3},vi.DEFAULT_CAMERA_PARAMETER={fov:60,near:30,far:5e5,speed_factor:2e3},vi.MINIMUM_HEIGHT=2,vi.MINIMUM_NEAR=1,vi.MINIMUM_FAR=5e5,vi.NEAR_FACTOR=.01,vi.FAR_FACTOR=1e4,vi.FOV_RANGE={min:5,max:120},vi.FOV_FACTOR=1.148698354997035,{StandardUIViewer:vi}}));
